from time import sleep
from subprocess import Popen, DEVNULL
from os import chmod
print("=================================================")
print("|  ByteBusters Secure Firmware Patching System  |")
print("=================================================")
print("Single-byte modification permitted for critical updates")


with open("chall", "rb") as f:
    data = bytearray(f.read())

idx = int(input("Target byte offset for patch: "), 0)
if idx < 0 or idx >= len(data):
    print("ERROR: Invalid memory address")
    exit(1)

patch = int(input("Replacement byte value: "), 0) & 0xff
data[idx] = patch

with open("/tmp/chall", "wb") as f:
    f.write(data)
chmod("/tmp/chall", 0o777)

print("WARNING: Integrity check failed!")
print("Execute anyway? Provide execution parameters:")

args = input().strip()

p = Popen(
    ["/tmp/chall"] + args.split(), env={}
)
p.wait()